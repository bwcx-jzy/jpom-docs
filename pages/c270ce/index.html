<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>探索 Java 项目如何实现自动升级 | Jpom项目运维</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/favicon.ico">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <noscript><meta http-equiv="refresh" content="0; url=https://jpom.io/noscript.html"><style>.theme-vdoing-content { display:none }</noscript>
    <script async="true" src="https://cdn.wwads.cn/js/makemoney.js" type="text/javascript"></script>
    <script src="/assets/js/common.js"></script>
    <script>
var _hmt = _hmt || [];
          </script>
    <script src="https://agi-dev-platform-web.bj.bcebos.com/ai_apaas/embed/output/embedLiteSDK.js?responseExpires=0"></script>
    <link rel="preload" href="/images/index/light.svg" as="image" type="image/svg+xml" fetchpriority="high">
    <link rel="preload" href="/images/index/dark.svg" as="image" type="image/svg+xml" fetchpriority="high">
    <link rel="preload" href="/images/index/read.svg" as="image" type="image/svg+xml" fetchpriority="high">
    <meta name="description" content="一款简而轻的低侵入式在线构建、自动部署、日常运维、项目监控开源软件">
    <meta name="keywords" content="Jpom,Jpom官网,Jpom文档,开源,管理系统,运维,项目运维,服务器运维,原生 ops,CI/CD,devops,自动部署,在线构建,项目管理系统,open source">
    <meta name="theme-color" content="#11a8cd">
    <meta name="og:type" content="website">
    <meta name="og:title" content="Jpom 项目管理系统文档">
    <meta name="og:url" content="https://jpom.top/">
    <meta name="og:site_name" content="Jpom 文档">
    <meta name="og:description" content="Jpom-项目管理系统,一款简而轻的低侵入式在线构建、自动部署、日常运维、项目监控软件">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="baidu-site-verification" content="code-te8iliecTI">
    <meta name="360-site-verification" content="0a5e4a367ff77232a3c1e9bc83edf7ba">
    <meta name="wwads-cn-verify" content="6da9003b743b65f4c0ccd295cc484e57">
    <meta name="google-site-verification" content="MA1Gbd51TsfBQa-4bZiaJfOnFiufsvLf5groklfa138">
    <meta name="google-adsense-account" content="ca-pub-8458956478992681">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
    
    <link rel="preload" href="/assets/css/7.styles.520986ba.css" as="style"><link rel="preload" href="/assets/js/app.28fbb888.js" as="script"><link rel="preload" href="/assets/js/9.dee3cbec.js" as="script"><link rel="preload" href="/assets/js/6.c6620675.js" as="script"><link rel="preload" href="/assets/js/1.5ec0786d.js" as="script"><link rel="prefetch" href="/assets/js/0.b5449532.js"><link rel="prefetch" href="/assets/js/2.a8fff7b4.js"><link rel="prefetch" href="/assets/js/3.2f1b58d4.js"><link rel="prefetch" href="/assets/js/4.bc8efbc2.js"><link rel="prefetch" href="/assets/js/5.80929858.js">
    <link rel="stylesheet" href="/assets/css/7.styles.520986ba.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open no-sidebar have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/logo/jpom_logo_small.svg" alt="Jpom项目运维" class="logo"> <span class="site-name can-hide">Jpom项目运维</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="💻演示系统" class="dropdown-title"><a href="/pages/2e4ffc/" class="link-title">💻演示系统</a> <span class="title" style="display:none;">💻演示系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">🔖回到首页</a></li><li class="dropdown-item"><!----> <a href="https://jpom.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  大陆站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://jpom.dromara.org " target="_blank" rel="noopener noreferrer" class="nav-link external">
  国际站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dromara.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  dromara 官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="📖安装文档" class="dropdown-title"><a href="/pages/install/" class="link-title">📖安装文档</a> <span class="title" style="display:none;">📖安装文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>立马上手安装</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/fe28e9/" class="nav-link">一键安装</a></li><li class="dropdown-subitem"><a href="/pages/db3065/" class="nav-link">下载安装</a></li><li class="dropdown-subitem"><a href="/pages/820286/" class="nav-link">容器安装</a></li><li class="dropdown-subitem"><a href="/pages/929085/" class="nav-link">安装服务</a></li></ul></li><li class="dropdown-item"><h4>大版本升级</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/upgrade/2.10.x-to-2.11.x/" class="nav-link">v2.10.X迁移到v2.11.X指南</a></li><li class="dropdown-subitem"><a href="/pages/upgrade/2.9.x-to-2.10.x/" class="nav-link">v2.9.X迁移到v2.10.X指南</a></li><li class="dropdown-subitem"><a href="/pages/upgrade/2.8.x-to-2.9.x/" class="nav-link">v2.8.X迁移到v2.9.X指南</a></li><li class="dropdown-subitem"><a href="/pages/db/4cfb46/" class="nav-link">数据库迁移到 mysql</a></li><li class="dropdown-subitem"><a href="/pages/db/5622b5/" class="nav-link">数据库迁移到 mariadb</a></li><li class="dropdown-subitem"><a href="/pages/db/e59f84/" class="nav-link">数据库迁移到 postgresql</a></li></ul></li><li class="dropdown-item"><h4>文档碎片</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🔥实践案例" class="dropdown-title"><a href="/pages/practice/" class="link-title">🔥实践案例</a> <span class="title" style="display:none;">🔥实践案例</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/practice/catalogue/" class="nav-link">实践案例目录</a></li><li class="dropdown-item"><!----> <a href="/pages/oauth/898d2e/" class="nav-link">Oauth2平台登录</a></li><li class="dropdown-item"><h4>安装实践</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/practice/15b7a2/" class="nav-link">一键安装教程</a></li><li class="dropdown-subitem"><a href="/pages/practice/c846d3/" class="nav-link">Docker 容器安装教程</a></li><li class="dropdown-subitem"><a href="/pages/practice/af288b/" class="nav-link">离线安装教程</a></li></ul></li><li class="dropdown-item"><h4>通用教程</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/practice/build-jpom/" class="nav-link">Jpom 为 Jpom 发版</a></li><li class="dropdown-subitem"><a href="/pages/practice/ea3667/" class="nav-link">自定义第三方通知</a></li><li class="dropdown-subitem"><a href="/pages/practice/dc2837/" class="nav-link">DSL 项目来管理 NGINX</a></li><li class="dropdown-subitem"><a href="/pages/practice/jpom-server-cert-manage/" class="nav-link">管理证书文件</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="❓常见问题" class="dropdown-title"><a href="/pages/FQA/" class="link-title">❓常见问题</a> <span class="title" style="display:none;">❓常见问题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/FQA/proper-noun/" class="nav-link">名词解释</a></li><li class="dropdown-item"><!----> <a href="/pages/FQA/839836/" class="nav-link">账户相关</a></li><li class="dropdown-item"><!----> <a href="/pages/FQA/6a1f29/" class="nav-link">构建相关</a></li><li class="dropdown-item"><!----> <a href="/pages/workspace/d3f985/" class="nav-link">工作空间</a></li><li class="dropdown-item"><!----> <a href="/pages/permissions/ca90a5/" class="nav-link">权限说明</a></li><li class="dropdown-item"><!----> <a href="/pages/350118/" class="nav-link">资产说明</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="💡DSL说明" class="dropdown-title"><a href="/pages/FQA/DSL/" class="link-title">💡DSL说明</a> <span class="title" style="display:none;">💡DSL说明</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/practice/4756ec/" class="nav-link">万能的 DSL 项目模板（Java）</a></li><li class="dropdown-item"><!----> <a href="/pages/practice/project-dsl-python/" class="nav-link">本地构建 + 自定义管理 python 项目</a></li><li class="dropdown-item"><!----> <a href="/pages/practice/610387/" class="nav-link">DSL 项目接口探活监控报警</a></li><li class="dropdown-item"><!----> <a href="/pages/practice/dc2837/" class="nav-link">DSL 项目来管理 NGINX</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="💖开源周边" class="dropdown-title"><a href="/pages/shop/" class="link-title">💖开源周边</a> <span class="title" style="display:none;">💖开源周边</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/praise/" class="nav-link">🔋赞赏支持💰</a></li><li class="dropdown-item"><!----> <a href="/pages/praise/publicity/" class="nav-link">📑赞赏记录</a></li><li class="dropdown-item"><!----> <a href="/pages/souvenir/" class="nav-link">🎁专属纪念品</a></li><li class="dropdown-item"><!----> <a href="/pages/praise/join/" class="nav-link">💬社群讨论</a></li><li class="dropdown-item"><!----> <a href="/pages/dc18b8/" class="nav-link">💪🏻如何贡献</a></li><li class="dropdown-item"><!----> <a href="/pages/praise/friends/" class="nav-link">👥贡献者们</a></li><li class="dropdown-item"><!----> <a href="/pages/user/" class="nav-link"> 🚩我们用户</a></li><li class="dropdown-item"><!----> <a href="/pages/enterprise-service/" class="nav-link">🤝企业服务</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="📰更新记录" class="dropdown-title"><a href="/pages/changelog/new/" class="link-title">📰更新记录</a> <span class="title" style="display:none;">📰更新记录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>发版日志</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/changelog/new/" class="nav-link">稳定版本-release</a></li><li class="dropdown-subitem"><a href="/pages/changelog/new-beta/" class="nav-link">内测版本-beta</a></li></ul></li><li class="dropdown-item"><h4>下载中心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/all-downloads/" class="nav-link">稳定版本-release</a></li><li class="dropdown-subitem"><a href="/pages/all-beta-downloads/" class="nav-link">内测版本-beta</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="📦开源仓库" class="dropdown-title"><!----> <span class="title" style="display:;">📦开源仓库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/dromara/Jpom" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/dromara/Jpom" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitcode.com/dromara/Jpom/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitcode
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="💻演示系统" class="dropdown-title"><a href="/pages/2e4ffc/" class="link-title">💻演示系统</a> <span class="title" style="display:none;">💻演示系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">🔖回到首页</a></li><li class="dropdown-item"><!----> <a href="https://jpom.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  大陆站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://jpom.dromara.org " target="_blank" rel="noopener noreferrer" class="nav-link external">
  国际站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://dromara.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  dromara 官网
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="📖安装文档" class="dropdown-title"><a href="/pages/install/" class="link-title">📖安装文档</a> <span class="title" style="display:none;">📖安装文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>立马上手安装</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/fe28e9/" class="nav-link">一键安装</a></li><li class="dropdown-subitem"><a href="/pages/db3065/" class="nav-link">下载安装</a></li><li class="dropdown-subitem"><a href="/pages/820286/" class="nav-link">容器安装</a></li><li class="dropdown-subitem"><a href="/pages/929085/" class="nav-link">安装服务</a></li></ul></li><li class="dropdown-item"><h4>大版本升级</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/upgrade/2.10.x-to-2.11.x/" class="nav-link">v2.10.X迁移到v2.11.X指南</a></li><li class="dropdown-subitem"><a href="/pages/upgrade/2.9.x-to-2.10.x/" class="nav-link">v2.9.X迁移到v2.10.X指南</a></li><li class="dropdown-subitem"><a href="/pages/upgrade/2.8.x-to-2.9.x/" class="nav-link">v2.8.X迁移到v2.9.X指南</a></li><li class="dropdown-subitem"><a href="/pages/db/4cfb46/" class="nav-link">数据库迁移到 mysql</a></li><li class="dropdown-subitem"><a href="/pages/db/5622b5/" class="nav-link">数据库迁移到 mariadb</a></li><li class="dropdown-subitem"><a href="/pages/db/e59f84/" class="nav-link">数据库迁移到 postgresql</a></li></ul></li><li class="dropdown-item"><h4>文档碎片</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🔥实践案例" class="dropdown-title"><a href="/pages/practice/" class="link-title">🔥实践案例</a> <span class="title" style="display:none;">🔥实践案例</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/practice/catalogue/" class="nav-link">实践案例目录</a></li><li class="dropdown-item"><!----> <a href="/pages/oauth/898d2e/" class="nav-link">Oauth2平台登录</a></li><li class="dropdown-item"><h4>安装实践</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/practice/15b7a2/" class="nav-link">一键安装教程</a></li><li class="dropdown-subitem"><a href="/pages/practice/c846d3/" class="nav-link">Docker 容器安装教程</a></li><li class="dropdown-subitem"><a href="/pages/practice/af288b/" class="nav-link">离线安装教程</a></li></ul></li><li class="dropdown-item"><h4>通用教程</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/practice/build-jpom/" class="nav-link">Jpom 为 Jpom 发版</a></li><li class="dropdown-subitem"><a href="/pages/practice/ea3667/" class="nav-link">自定义第三方通知</a></li><li class="dropdown-subitem"><a href="/pages/practice/dc2837/" class="nav-link">DSL 项目来管理 NGINX</a></li><li class="dropdown-subitem"><a href="/pages/practice/jpom-server-cert-manage/" class="nav-link">管理证书文件</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="❓常见问题" class="dropdown-title"><a href="/pages/FQA/" class="link-title">❓常见问题</a> <span class="title" style="display:none;">❓常见问题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/FQA/proper-noun/" class="nav-link">名词解释</a></li><li class="dropdown-item"><!----> <a href="/pages/FQA/839836/" class="nav-link">账户相关</a></li><li class="dropdown-item"><!----> <a href="/pages/FQA/6a1f29/" class="nav-link">构建相关</a></li><li class="dropdown-item"><!----> <a href="/pages/workspace/d3f985/" class="nav-link">工作空间</a></li><li class="dropdown-item"><!----> <a href="/pages/permissions/ca90a5/" class="nav-link">权限说明</a></li><li class="dropdown-item"><!----> <a href="/pages/350118/" class="nav-link">资产说明</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="💡DSL说明" class="dropdown-title"><a href="/pages/FQA/DSL/" class="link-title">💡DSL说明</a> <span class="title" style="display:none;">💡DSL说明</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/practice/4756ec/" class="nav-link">万能的 DSL 项目模板（Java）</a></li><li class="dropdown-item"><!----> <a href="/pages/practice/project-dsl-python/" class="nav-link">本地构建 + 自定义管理 python 项目</a></li><li class="dropdown-item"><!----> <a href="/pages/practice/610387/" class="nav-link">DSL 项目接口探活监控报警</a></li><li class="dropdown-item"><!----> <a href="/pages/practice/dc2837/" class="nav-link">DSL 项目来管理 NGINX</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="💖开源周边" class="dropdown-title"><a href="/pages/shop/" class="link-title">💖开源周边</a> <span class="title" style="display:none;">💖开源周边</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/praise/" class="nav-link">🔋赞赏支持💰</a></li><li class="dropdown-item"><!----> <a href="/pages/praise/publicity/" class="nav-link">📑赞赏记录</a></li><li class="dropdown-item"><!----> <a href="/pages/souvenir/" class="nav-link">🎁专属纪念品</a></li><li class="dropdown-item"><!----> <a href="/pages/praise/join/" class="nav-link">💬社群讨论</a></li><li class="dropdown-item"><!----> <a href="/pages/dc18b8/" class="nav-link">💪🏻如何贡献</a></li><li class="dropdown-item"><!----> <a href="/pages/praise/friends/" class="nav-link">👥贡献者们</a></li><li class="dropdown-item"><!----> <a href="/pages/user/" class="nav-link"> 🚩我们用户</a></li><li class="dropdown-item"><!----> <a href="/pages/enterprise-service/" class="nav-link">🤝企业服务</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="📰更新记录" class="dropdown-title"><a href="/pages/changelog/new/" class="link-title">📰更新记录</a> <span class="title" style="display:none;">📰更新记录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>发版日志</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/changelog/new/" class="nav-link">稳定版本-release</a></li><li class="dropdown-subitem"><a href="/pages/changelog/new-beta/" class="nav-link">内测版本-beta</a></li></ul></li><li class="dropdown-item"><h4>下载中心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/all-downloads/" class="nav-link">稳定版本-release</a></li><li class="dropdown-subitem"><a href="/pages/all-beta-downloads/" class="nav-link">内测版本-beta</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="📦开源仓库" class="dropdown-title"><!----> <span class="title" style="display:;">📦开源仓库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/dromara/Jpom" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/dromara/Jpom" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitcode.com/dromara/Jpom/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitcode
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <div class="sidebar-slot sidebar-slot-top">
  <div style="width:230px;margin:0 auto;display:flex;flex-direction: column;">
    <a href="https://gitee.com/dromara/MaxKey" target="_blank">
      <img  loading="lazy" class="no-zoom" height="60" width="224" src="/images/friends/ad/maxkey-banner.png">
    </a>
    <a href="https://www.xiaonuo.vip" target="_blank">
      <img  loading="lazy" class="no-zoom" height="60" width="224" src="/images/friends/ad/snowy-banner.jpg">
    </a>
     <a href="https://gitee.com/qingqinkj/mdp-lcode-ui-web" target="_blank" >
      <img  loading="lazy" class="no-zoom" height="60" width="224" src="/images/friends/ad/mdp-banner2.png">
    </a>
    <a href="https://www.jnpfsoft.com/index.html?from=jpom" target="_blank"  style="background:#dcf3ff">
          <img  loading="lazy" class="no-zoom" height="60" width="224" src="/images/friends/ad/jnpfsoft-banner2.png">
    </a>
     <a href="https://www.orangeforms.com/?from=jpom" target="_blank"  style="background:#f37700">
          <img  loading="lazy" class="no-zoom" height="60" width="224" src="/images/friends/ad/orangeforms-banner.jpg">
    </a>
    <div style="order: 9999;">
      <span style='color: gray;font-size: smaller;'>广告采用随机轮播方式显示</span>
      <span style='color: #E01E5A;font-size: smaller;font-weight: bolder;float: right'>❤️<a href='/pages/589c8e/'>成为赞助商</a></span>
    </div>
    <div style="order: 100000;background-color:var(--borderColor);width:100%;height:1px;margin: 30px 0px 0px 0px;position:relative;">
          <button style="border-radius: 100%;padding: 0;text-align: center;border: none;background-color: #ff3861;cursor: pointer;position: absolute;left: calc(50% - 15px);top: -15px;height: 30px;width: 30px;color: #fff;" onclick="document.getElementsByClassName('sidebar-slot-top')[0].style.display='none'">收</button>
    </div>
    </div>
  </div> <!----> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=%E6%8E%A8%E5%B9%BF%E6%96%87%E7%AB%A0" title="分类" data-v-06225672>推广文章</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://gitee.com/bwcx-jzy" target="_blank" title="作者" class="beLink" data-v-06225672>bwcx_jzy</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-03-02</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">探索 Java 项目如何实现自动升级<!----></h1> <div class="page-slot page-slot-top">
  <div class="wwads-cn wwads-horizontal page-wwads" data-id="188" style="display: flex !important"></div>
  </div> <div class="theme-vdoing-content content__default"><p><img src="/images/tutorial/f606531a8b16b027e7dd2b8d14d752a63c332e96.jpg" alt="banner" loading="lazy"></p> <p>📖本文将以 <a href="https://jpom.top" target="_blank" rel="noopener noreferrer">Jpom<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 为实际案例分享在 Java 项目中如何实现自动升级的功能。本文满满的干货，希望对大家有所启发或者帮助 🤔。</p> <p>💡文章预计阅读时长：15 ~ 20 分钟，建议先收藏再阅读避免后续找不到</p> <h2 id="jpom-简介-📰"><a href="#jpom-简介-📰" class="header-anchor">#</a> Jpom 简介 📰</h2> <p>🚀 <a href="https://jpom.top" target="_blank" rel="noopener noreferrer">Jpom<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是一款开源的项目运维系统，主要面向中小型企业团队，提供项目日常的部署、构建、脚本管理、SSH终端、Docker UI 等功能。</p> <p>🚀 <a href="https://jpom.top" target="_blank" rel="noopener noreferrer">Jpom<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 更是一款原生 ops 软件，给您带来了万物皆可脚本化的体验。</p> <h3 id="目前用户-🔥"><a href="#目前用户-🔥" class="header-anchor">#</a> 目前用户 🔥</h3> <p>根据目前的用户反馈+公开数据统计（保守估计）：</p> <ol><li>目前用户（公司）已经达 <strong>500+</strong></li> <li>涉及服务器已经达 <strong>3000+</strong></li></ol> <p>数据并且还在不断增加中</p> <ul><li>Jpom 仓库：<a href="https://gitee.com/dromara/Jpom" target="_blank" rel="noopener noreferrer">https://gitee.com/dromara/Jpom<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Jpom 文档：<a href="https://jpom.top" target="_blank" rel="noopener noreferrer">https://jpom.top<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="升级背景-💬"><a href="#升级背景-💬" class="header-anchor">#</a> 升级背景 💬</h2> <p>日常使用很多桌面软件，都会遇到软件升级的情况。绝大多数的软件均支持弹窗提示新版本并且点击升级按钮后自动完成整个升级流程，让用户无须过多操作即可，满满的便利性。</p> <p>但是在我们 Java 程序中实现类似的功能的软件项目不是很多，其中不泛一些客观因素不需要此功能，但是在一些小项目、公司内部项目、开源项目中，此功能还是能给使用者（用户）带来极大的便利性。</p> <h3 id="java-项目的局限性-❗"><a href="#java-项目的局限性-❗" class="header-anchor">#</a> Java 项目的局限性 ❗</h3> <p>通常一个 Java 项目在服务器中运行时是独立运行的，没有守护程序或者其他进程来监控和管理（ <em>如果可以靠守护程序和监管程序升级方式可以更多样化，此方式不在本地讨论范畴中</em> ）。</p> <p>这样的场景要实现升级就存在一个局限性，程序必须自身控制关闭自身并且启动新的程序包，但 Jpom 经过多版本和不同用户使用场景实践后发现 Java 项目也能轻松实现自动升级。</p> <h3 id="jpom-中支持的升级方式有-🔖"><a href="#jpom-中支持的升级方式有-🔖" class="header-anchor">#</a> Jpom 中支持的升级方式有 🔖</h3> <ol><li>在线升级</li> <li>上传升级</li> <li>手动升级</li></ol> <ul><li>在线升级和上传升级的原理是一致的，更新程序包的来源方式不一致。</li> <li>在线升级是自动下载新的程序包、上传升级是手动上传新的程序包到系统中。</li> <li>手动升级是最原始的大家平常使用的升级方式：手动下载新的程序包、手动上传新的程序包到服务器中。</li></ul> <p>Jpom 升级文档：<a href="/pages/FQA/upgrade/">文档</a></p> <h2 id="升级前提-📌"><a href="#升级前提-📌" class="header-anchor">#</a> 升级前提 📌</h2> <p>不同软件的使用场景、用户群体、整体架构等不同，导致部分软件是不能使用自动升级的方式（ <em>不能使用自动升级的细节情况不在本文讨论范畴中</em> ）。</p> <p>一般来说可以实现自动升级的软件有如下特点：</p> <ul><li>独立运行：项目本身是单机运行的，不涉及到分布式集群。</li> <li>依赖简单：项目不依赖过多的外部组件。</li> <li>业务平滑：业务逻辑变更不会影响旧版本数据的兼容性。</li> <li>环境稳定：项目运行环境相对稳定，无需频繁调整配置。</li></ul> <h3 id="通用升级流程-🏗"><a href="#通用升级流程-🏗" class="header-anchor">#</a> 通用升级流程 🏗</h3> <ol><li>检查是否有新版本；</li> <li>判断是否可以平滑升级；</li> <li>下载/上传升级包；</li> <li>执行升级流程；
<ul><li>数据升级</li> <li>程序包升级</li></ul></li> <li>等待升级结果。</li></ol> <h2 id="程序变动-🛠"><a href="#程序变动-🛠" class="header-anchor">#</a> 程序变动 🛠</h2> <p>如果需要使用 Java 实现自动升级那么您需要对程序做如下变动调整：</p> <ol><li>程序能自动升级数据库表结构（核心变动）</li> <li>需要将您的程序调整为脚本控制（大多数程序均是如此）</li> <li>程序能兼容不同版本的配置文件（向下兼容）</li> <li>实现升级的业务流程（一般是 web 项目需要管理页面）</li></ol> <h3 id="数据库-💿"><a href="#数据库-💿" class="header-anchor">#</a> 数据库 💿</h3> <blockquote><p>数据库表结构升级是实现自动升级的核心问题，如果您的项目不使用数据库可以忽略此环节。</p></blockquote> <p>大多数软件的版本升级均是提前手动处理数据库表结构，然后在手动升级（替换）程序包</p> <p>要实现自动升级就必须解决数据库表结构升级的问题。</p> <p>数据库表结构升级自动化解决办法通常可以使用第三方工具，
如 <a href="https://flywaydb.org/" target="_blank" rel="noopener noreferrer">FlyWay<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://github.com/liquibase/liquibase" target="_blank" rel="noopener noreferrer">Liquibase<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 等
（ <em>本文主要使用 Jpom 作为案例，使用工具库不在本文讨论范畴</em>）。</p> <p>如果您的程序规模和复杂度不高，可以考虑自研实行数据库表结构升级。</p> <p>Jpom 中目前就是采用自研实现的数据库升级（Jpom 中目前并未考虑回退版本的情况）</p> <p>实现思路：（如有不足还请帮忙更正）</p> <ol><li>CSV 记录数据库表结构</li> <li>程序启动时读取 CSV 文件</li> <li>解析为数据库的 DLL 语句</li> <li>判断是否以及执行过</li> <li>执行 DLL 语句</li> <li>缓存成功执行的 DLL 语句</li></ol> <h4 id="csv-规范-📑"><a href="#csv-规范-📑" class="header-anchor">#</a> CSV 规范 📑</h4> <p>这里我们提前规划好完整的表、后期修改的表 、变更表索引、需要执行的扩展 SQL，可以总结为四大类型：<code>新增表</code>、<code>修改表</code>、<code>创建/修改索引</code>、<code>扩展 SQL</code></p> <blockquote><p>下列定义的 CSV 规范仅供参考实际需要根据您的业务情况和数据库进行适当调整</p> <p>Jpom 中目前仅兼容了 H2、Mysql 数据库</p></blockquote> <p><strong>Jpom 中新增表规则示例</strong></p> <div style="overflow-x:auto;"><table><thead><tr><th>tableName</th> <th>name</th> <th>type</th> <th>len</th> <th>defaultValue</th> <th>notNull</th> <th>primaryKey</th> <th>comment</th> <th>tableComment</th></tr></thead> <tbody><tr><td>SCRIPT_INFO</td> <td>id</td> <td>String</td> <td>50</td> <td></td> <td>true</td> <td>true</td> <td>id</td> <td>节点脚本模版</td></tr> <tr><td>SCRIPT_INFO</td> <td>createTimeMillis</td> <td>Long</td> <td></td> <td></td> <td>false</td> <td>false</td> <td>数据创建时间</td> <td></td></tr> <tr><td>SCRIPT_INFO</td> <td>modifyTimeMillis</td> <td>Long</td> <td></td> <td></td> <td>false</td> <td>false</td> <td>数据修改时间</td> <td></td></tr> <tr><td>SCRIPT_INFO</td> <td>modifyUser</td> <td>String</td> <td>50</td> <td></td> <td>false</td> <td>false</td> <td>修改人</td> <td></td></tr></tbody></table></div> <p><strong>Jpom 中修改表规则示例</strong></p> <div style="overflow-x:auto;"><table><thead><tr><th>alterType</th> <th>tableName</th> <th>name</th> <th>type</th> <th>len</th> <th>defaultValue</th> <th>comment</th> <th>notNull</th></tr></thead> <tbody><tr><td>ADD</td> <td>PROJECT_INFO</td> <td>triggerToken</td> <td>String</td> <td>100</td> <td></td> <td>触发器token</td> <td></td></tr> <tr><td>ALTER</td> <td>FILE_STORAGE</td> <td>name</td> <td>String</td> <td>255</td> <td></td> <td>名称</td> <td>true</td></tr> <tr><td>DROP</td> <td>SSHTERMINALEXECUTELOG</td> <td>optTime</td> <td></td> <td></td> <td></td> <td></td> <td></td></tr></tbody></table></div> <p><strong>Jpom 中索引规则示例</strong></p> <div style="overflow-x:auto;"><table><thead><tr><th>indexType</th> <th>tableName</th> <th>name</th> <th>field</th></tr></thead> <tbody><tr><td>ADD-UNIQUE</td> <td>USER_INFO</td> <td>USER_INF_SALT_INDEX1</td> <td>salt</td></tr> <tr><td>ADD</td> <td>STATIC_FILE_STORAGE</td> <td>DIR_TASK_ID</td> <td>staticDir+scanTaskId</td></tr> <tr><td>ADD</td> <td>TRIGGER_TOKEN_LOG</td> <td>TRIGGER_TOKEN_TYPE</td> <td>type</td></tr></tbody></table></div> <p><strong>Jpom 中扩展 SQL 规则</strong></p> <p>如果数据库在一定情况下需要执行一些初始化操作，版本变更需要对数据进行默认操作或者批量修改、删除、新增等
您可以使用扩展 SQL 来实现，扩展 SQL 唯一需要注意的就是分割符了，因为 JDBC 批量执行多条 SQL 只会执行第一条，后续的将自动忽略，需要您自行分割后再执行。</p> <p>在 Jpom 中为了保证 DLL 语句重复执行不报错，或者减少不必要的 DLL 语句执行，在<code>添加字段</code>、<code>删除字段</code>、<code>删除索引</code>操作时候依赖数据库函数实现，此时就需要提前执行创建函数的 SQL,来达到后续操作可以顺利执行。</p> <p>参考 SQL：<a href="https://gitee.com/dromara/Jpom/blob/master/modules/server/src/main/resources/sql-view/execute.mysql.v1.0.sql" target="_blank" rel="noopener noreferrer">https://gitee.com/dromara/Jpom/blob/master/modules/server/src/main/resources/sql-view/execute.mysql.v1.0.sql<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="缓存-dll-记录-🧾"><a href="#缓存-dll-记录-🧾" class="header-anchor">#</a> 缓存 DLL 记录 🧾</h4> <p>大多数数据库 DLL 语句并不是幂等的，多次执行同一个 DLL 语句可能会报错，这样就是我们非常不期望出现的。</p> <p>推荐方案在执行 DLL 语句前将签名一次（<code>MD5</code>、<code>SHA1</code>）,判断签名后的值是否以及被执行过，如果没有执行则执行并缓存成功。</p> <p>Jpom 相关代码参考地址：</p> <ol><li><a href="https://gitee.com/dromara/Jpom/tree/master/modules/server/src/main/resources/sql-view" target="_blank" rel="noopener noreferrer">https://gitee.com/dromara/Jpom/tree/master/modules/server/src/main/resources/sql-view<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://gitee.com/dromara/Jpom/blob/master/modules/storage-module/storage-module-common/src/main/java/org/dromara/jpom/db/IStorageSqlBuilderService.java" target="_blank" rel="noopener noreferrer">https://gitee.com/dromara/Jpom/blob/master/modules/storage-module/storage-module-common/src/main/java/org/dromara/jpom/db/IStorageSqlBuilderService.java<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://gitee.com/dromara/Jpom/blob/master/modules/server/src/main/java/org/dromara/jpom/system/db/InitDb.java" target="_blank" rel="noopener noreferrer">https://gitee.com/dromara/Jpom/blob/master/modules/server/src/main/java/org/dromara/jpom/system/db/InitDb.java<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol> <h3 id="管理脚本-🧩"><a href="#管理脚本-🧩" class="header-anchor">#</a> 管理脚本 🧩</h3> <p>在管理 Java 项目的脚本通常要考虑实现：对应的项目启动、停止、重启、查询状态。</p> <p>要实现自动升级其实我们只需要在您原有的管理脚本中调整启动环节即可，主要需要考虑如何识别到新版本的程序包、项目的控制台日志文件使用的路径即可。</p> <p>管理脚本会业务不同使用环境有所不同 Linux、Windows（一定要注意文件句柄被占用的情况）、MacOS 等等，所以我们需要根据不同的操作系统来编写不同的管理脚本。</p> <h4 id="实现方案-👏"><a href="#实现方案-👏" class="header-anchor">#</a> 实现方案 👏</h4> <ol><li>替换管理脚本中的值（较复杂）</li> <li>自动读取标记文件（推荐）</li></ol> <blockquote><p>如有更优方案恳请分享</p> <p>Jpom 中早期版本使用的是方案 1，后期版本使用的是方案 2。</p></blockquote> <p>方案一的缺点：程序需要修改管理脚本文件，容易产生修改前后编码格式不一致，脚本规则定义不明确会出现难替换问题</p> <h4 id="推荐实现-👍"><a href="#推荐实现-👍" class="header-anchor">#</a> 推荐实现 👍</h4> <p>我们推荐您使用标记文件的方案来实现，主要流程如下：</p> <p>在管理脚本启动流程（函数）读取标记文件中的值来来运行程序。</p> <p>假设我们管理脚本定义来如下变量：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token assign-left variable">Lib</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${base}</span>/lib/&quot;</span>
<span class="token assign-left variable">LogPath</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${base}</span>/logs/&quot;</span>
<span class="token assign-left variable">RUN_JAR</span><span class="token operator">=</span><span class="token string">&quot;&quot;</span>
<span class="token assign-left variable">Log</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${LogPath}</span>/stdout.log&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>当我们在启动时候先判断标记文件是否存在（假设这里我们定义标记文件为：<code>run.bin</code>），
如果存在标记文件我们则读取这个文件里面的值并将其赋值给 <code>RUN_JAR</code> 变量，
如果不存在标记文件表示第一次启动，我们建议您读取 Lib 目录下面的第一个 jar 包并将其赋值给 <code>RUN_JAR</code> 变量，
如果 Lib 目录下面没有 jar 包，则表示没有可运行的程序，程序启动失败。</p> <p>经过上述流程我们即可拼接最终的启动命令。</p> <p><code>nohup java -server -XX:+UseG1GC XXXX -jar ${Lib}/${RUN_JAR} XXXX &gt;&gt;$Log 2&gt;&amp;1 &amp;</code></p> <p>如果您是 classpath 模式运行其实类似的方式只能需要修改生成所有的 jar 全路径和最终的启动命令即可。</p> <p>Jpom 中的实现函数截取示例（Linux）：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token keyword">function</span> <span class="token function-name function">checkConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">&quot;<span class="token variable">${RUN_JAR}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
		<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-f</span> <span class="token string">&quot;<span class="token variable">$Lib</span>/run.bin&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
			<span class="token assign-left variable">RUN_JAR</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> <span class="token string">&quot;<span class="token variable">$Lib</span>/run.bin&quot;</span><span class="token variable">)</span></span>
			<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-f</span> <span class="token string">&quot;<span class="token variable">$Lib</span>/<span class="token variable">$RUN_JAR</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
				errorExit <span class="token string">&quot;Cannot find <span class="token variable">$Lib</span>/<span class="token variable">$RUN_JAR</span> jar&quot;</span>
			<span class="token keyword">fi</span>
			<span class="token builtin class-name">echo</span> <span class="token string">&quot;specify running：<span class="token variable">${RUN_JAR}</span>&quot;</span>
		<span class="token keyword">else</span>
			<span class="token assign-left variable">RUN_JAR</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">find</span> <span class="token string">&quot;<span class="token variable">${Lib}</span>&quot;</span> <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> <span class="token string">&quot;*.jar&quot;</span> <span class="token parameter variable">-exec</span> <span class="token function">ls</span> <span class="token parameter variable">-t</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> + <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-1</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s#.*/##'</span><span class="token variable">)</span></span>
			<span class="token comment"># error</span>
			<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">&quot;<span class="token variable">${RUN_JAR}</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
				errorExit <span class="token string">&quot;Jar not found&quot;</span>
			<span class="token keyword">fi</span>
			<span class="token builtin class-name">echo</span> <span class="token string">&quot;automatic running：<span class="token variable">${RUN_JAR}</span>&quot;</span>
		<span class="token keyword">fi</span>
	<span class="token keyword">fi</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="windows-环境-💻"><a href="#windows-环境-💻" class="header-anchor">#</a> windows 环境 💻</h4> <p>根据上述描述可以发现我们并未修改项目控制台日志路径，和整体描述不一致。</p> <p>因为如果您仅在 Linux 环境运行上述推荐实现以及完全 OK ，但是如果您需要在 Windows 环境运行，那么您需要修改控制台日志路径（<strong>Jpom 是兼容 Linux、Windows 环境的</strong>）。</p> <p>Windows 下假设定义如下变量：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">set</span> <span class="token assign-left variable">log_dir</span><span class="token operator">=</span>%ENV_PATH%<span class="token punctuation">\</span><span class="token punctuation">..</span><span class="token punctuation">\</span>logs
<span class="token builtin class-name">set</span> <span class="token assign-left variable">Lib</span><span class="token operator">=</span>%ENV_PATH%<span class="token punctuation">\</span><span class="token punctuation">..</span><span class="token punctuation">\</span>lib<span class="token punctuation">\</span>
<span class="token builtin class-name">set</span> <span class="token string">&quot;RUN_JAR=&quot;</span>
<span class="token builtin class-name">set</span> <span class="token assign-left variable">stdout_log</span><span class="token operator">=</span><span class="token string">&quot;%log_dir%\stdout.log&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Jpom 中的实现函数截取示例（Windows）：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>@REM get jar
:listDir
	<span class="token keyword">if</span> <span class="token string">&quot;%RUN_JAR%&quot;</span><span class="token operator">==</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">(</span>
		<span class="token keyword">if</span> exist <span class="token string">&quot;%Lib%<span class="token entity" title="\r">\r</span>un.bin&quot;</span> <span class="token punctuation">(</span>
			<span class="token builtin class-name">set</span> /P <span class="token assign-left variable">RUN_JAR</span><span class="token operator">=</span><span class="token operator">&lt;</span><span class="token string">&quot;%Lib%<span class="token entity" title="\r">\r</span>un.bin&quot;</span>
			<span class="token builtin class-name">set</span> <span class="token assign-left variable">JAR_MSG</span><span class="token operator">=</span>specify running <span class="token operator">!</span>RUN_JAR<span class="token operator">!</span>
		<span class="token punctuation">)</span>else <span class="token punctuation">(</span>
			<span class="token keyword">for</span> /f <span class="token string">&quot;delims=&quot;</span> %%I <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">'dir /B %Lib%'</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token punctuation">(</span>
				<span class="token keyword">if</span> exist %Lib%%%I <span class="token keyword">if</span> not exist %Lib%%%I<span class="token punctuation">\</span>nul <span class="token punctuation">(</span>
					<span class="token keyword">if</span> <span class="token string">&quot;%%~xI&quot;</span> <span class="token operator">==</span><span class="token string">&quot;.jar&quot;</span> <span class="token punctuation">(</span>
						<span class="token keyword">if</span> <span class="token string">&quot;%RUN_JAR%&quot;</span><span class="token operator">==</span><span class="token string">&quot;&quot;</span> <span class="token punctuation">(</span>
							<span class="token builtin class-name">set</span> <span class="token string">&quot;RUN_JAR=%%I&quot;</span>
						<span class="token punctuation">)</span>
					<span class="token punctuation">)</span>
				<span class="token punctuation">)</span>
			<span class="token punctuation">)</span>
			<span class="token builtin class-name">set</span> <span class="token assign-left variable">JAR_MSG</span><span class="token operator">=</span>auto running <span class="token operator">!</span>RUN_JAR<span class="token operator">!</span>
		<span class="token punctuation">)</span>
	<span class="token punctuation">)</span>else <span class="token punctuation">(</span>
		<span class="token builtin class-name">set</span> <span class="token assign-left variable">JAR_MSG</span><span class="token operator">=</span>specify2 running %RUN_JAR%
	<span class="token punctuation">)</span>
	<span class="token keyword">if</span> not exist %Lib%<span class="token operator">!</span>RUN_JAR<span class="token operator">!</span> <span class="token punctuation">(</span>
	 	<span class="token builtin class-name">echo</span> %JAR_MSG%
		<span class="token builtin class-name">echo</span> <span class="token function">file</span> not exist %Lib%<span class="token operator">!</span>RUN_JAR<span class="token operator">!</span>
		PAUSE
		EXIT <span class="token parameter variable">-1</span>
	<span class="token punctuation">)</span>
	@REM stdout_log
	<span class="token keyword">if</span> exist <span class="token string">&quot;%Lib%<span class="token entity" title="\r">\r</span>un.bin&quot;</span> <span class="token punctuation">(</span>
		<span class="token builtin class-name">set</span> /P <span class="token assign-left variable">RUN_LOG</span><span class="token operator">=</span><span class="token operator">&lt;</span><span class="token string">&quot;%Lib%<span class="token entity" title="\r">\r</span>un.log&quot;</span>
		<span class="token builtin class-name">set</span> <span class="token assign-left variable">stdout_log</span><span class="token operator">=</span><span class="token string">&quot;%log_dir%\!RUN_LOG!&quot;</span>
	<span class="token punctuation">)</span>
goto:eof
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><blockquote><p>标记文件存放位置根据自己的喜好包目录结构存储即可没有特殊要求（建议存储在脚本或者程序包同级目录下）</p></blockquote> <p>Jpom 管理脚本完整参考：</p> <ul><li>linux：<a href="https://gitee.com/dromara/Jpom/blob/master/modules/server/src/main/bin/Server.sh" target="_blank" rel="noopener noreferrer">https://gitee.com/dromara/Jpom/blob/master/modules/server/src/main/bin/Server.sh<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>windows：<a href="https://gitee.com/dromara/Jpom/blob/master/modules/server/src/main/bin/Server.bat" target="_blank" rel="noopener noreferrer">https://gitee.com/dromara/Jpom/blob/master/modules/server/src/main/bin/Server.bat<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="代码细节"><a href="#代码细节" class="header-anchor">#</a> 代码细节 ⁉</h3> <p>我们在开发升级业务的时候我们需要考虑一些细节，根据 Jpom 的经验如下：</p> <ol><li>执行脚本的方式（难点）</li> <li>考虑注册为服务（非必要）</li> <li>异步执行升级脚本（用户体验）</li></ol> <p>通常我们执行项目重启命令为：</p> <p><code>bash /xxxx/xxxx.sh restart</code> or <code>bash /xxxx/xxxx.bat restart</code></p> <p>如果注册为服务执行重启命令为：</p> <p><code>systemctl restart xxxxx.service</code></p> <h4 id="执行脚本的方式-🤔"><a href="#执行脚本的方式-🤔" class="header-anchor">#</a> 执行脚本的方式 🤔</h4> <p>在 java 中我们通常使用 <code>Runtime.getRuntime().exec(command)</code>来执行命令，但是这种方式在升级流程不适用，因为这里涉及到父进程和子进程的相关知识。</p> <p>因为 java 默认执行脚本的标准输出目标是：<code>ProcessBuilder.Redirect.PIPE</code></p> <p><strong>PIPE</strong>：表示子进程的 I/O 源或目标将与当前进程的 I/O 源或目标相同。 这是大多数操作系统命令解释器（shell）的正常行为。</p> <p>这样当您执行重启当前项目的脚本时候，自身进程已经关闭，子进程也将自动关闭这样就无法实现自己重启自己。</p> <p>所以我们需要将标准输出目标设置为：<code>ProcessBuilder.Redirect.INHERIT</code></p> <p><strong>INHERIT</strong>：指示子进程 I/O 将通过管道连接到当前 Java 进程。 这是子进程标准 I/O 的默认处理。</p> <p>这样就可以达到执行重启脚本时候，创建的子进程不受父进程影响。</p> <p>参考代码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">asyncExeLocalCommand</span><span class="token punctuation">(</span><span class="token class-name">String</span> command<span class="token punctuation">,</span> <span class="token class-name">File</span> file<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> env<span class="token punctuation">,</span> <span class="token keyword">boolean</span> useSudo<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> newCommand <span class="token operator">=</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token constant">CRLF</span><span class="token punctuation">,</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token constant">SPACE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    newCommand <span class="token operator">=</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>newCommand<span class="token punctuation">,</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token constant">LF</span><span class="token punctuation">,</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token constant">SPACE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>useSudo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        newCommand <span class="token operator">=</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">addPrefixIfNot</span><span class="token punctuation">(</span>newCommand<span class="token punctuation">,</span> <span class="token string">&quot;sudo &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>newCommand<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> commands <span class="token operator">=</span> <span class="token function">getCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    commands<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>newCommand<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ProcessBuilder</span> pb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span>commands<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>file <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        pb<span class="token punctuation">.</span><span class="token function">directory</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> environment <span class="token operator">=</span> pb<span class="token punctuation">.</span><span class="token function">environment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>env <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        environment<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    pb<span class="token punctuation">.</span><span class="token function">redirectOutput</span><span class="token punctuation">(</span><span class="token class-name">ProcessBuilder<span class="token punctuation">.</span>Redirect</span><span class="token punctuation">.</span><span class="token constant">INHERIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pb<span class="token punctuation">.</span><span class="token function">redirectError</span><span class="token punctuation">(</span><span class="token class-name">ProcessBuilder<span class="token punctuation">.</span>Redirect</span><span class="token punctuation">.</span><span class="token constant">INHERIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pb<span class="token punctuation">.</span><span class="token function">redirectInput</span><span class="token punctuation">(</span><span class="token class-name">ProcessBuilder<span class="token punctuation">.</span>Redirect</span><span class="token punctuation">.</span><span class="token constant">INHERIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pb<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>这样设置后 java 程序里面无法直接知道执行命令的结果，需要采用获取当前项目是否在运行的方式来判断执行是否成功。</p> <ul><li>执行前后进程 ID 一致：表示脚本没有正确执行</li> <li>执行前后进程 ID 不一致：表示项目重启成功，需要人工判断是否升级成功</li> <li>执行后没有新进程：表示项目启动失败</li></ul> <blockquote><p>提醒：Jpom 目前仅判断了项目进程是否存在，并未判断前后进程是否一致</p></blockquote> <h4 id="注册为服务-🎛"><a href="#注册为服务-🎛" class="header-anchor">#</a> 注册为服务 🎛</h4> <p>假设您的项目支持使用服务的方式启动，此时我们在代码里面就需要考虑使用重启服务的命令来重启项目，而不是直接使用 bash 来重启。</p> <p>我们建议您将服务名注入到环境变量中，在执行重启时候判断是否存在环境变量，如果存在则使用服务方式来重启，否则使用 bash 方式来重启。</p> <p>服务的方式又需要考虑是否需要使用 sudo 来执行命令，服务一般是需要 root 权限（这块建议自行根据业务评估实现）</p> <p>Jpom 中实现代码参考：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">File</span> runFile <span class="token operator">=</span> <span class="token class-name">JpomManifest</span><span class="token punctuation">.</span><span class="token function">getRunPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">File</span> runPath <span class="token operator">=</span> runFile<span class="token punctuation">.</span><span class="token function">getParentFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>runPath<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">JpomRuntimeException</span><span class="token punctuation">(</span>runPath<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">OsInfo</span> osInfo <span class="token operator">=</span> <span class="token class-name">SystemUtil</span><span class="token punctuation">.</span><span class="token function">getOsInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>osInfo<span class="token punctuation">.</span><span class="token function">isWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 需要重新变更 stdout_log 文件来保证进程不被占用</span>
        <span class="token class-name">String</span> format <span class="token operator">=</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;stdout_{}.log&quot;</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">writeString</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span>runPath<span class="token punctuation">,</span> <span class="token string">&quot;run.log&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">CharsetUtil</span><span class="token punctuation">.</span><span class="token constant">CHARSET_UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">File</span> scriptFile <span class="token operator">=</span> <span class="token class-name">JpomManifest</span><span class="token punctuation">.</span><span class="token function">getScriptFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ThreadUtil</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// Waiting for method caller,For example, the interface response</span>
        <span class="token class-name">ThreadUtil</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> command <span class="token operator">=</span> <span class="token class-name">CommandUtil</span><span class="token punctuation">.</span><span class="token function">generateCommand</span><span class="token punctuation">(</span>scriptFile<span class="token punctuation">,</span> <span class="token string">&quot;restart upgrade&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">File</span> parentFile <span class="token operator">=</span> scriptFile<span class="token punctuation">.</span><span class="token function">getParentFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>osInfo<span class="token punctuation">.</span><span class="token function">isWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//String result = CommandUtil.execSystemCommand(command, scriptFile.getParentFile());</span>
                <span class="token comment">//log.debug(&quot;windows restart {}&quot;, result);</span>
                <span class="token class-name">CommandUtil</span><span class="token punctuation">.</span><span class="token function">asyncExeLocalCommand</span><span class="token punctuation">(</span><span class="token string">&quot;start /b&quot;</span> <span class="token operator">+</span> command<span class="token punctuation">,</span> parentFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token class-name">String</span> jpomService <span class="token operator">=</span> <span class="token class-name">SystemUtil</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;JPOM_SERVICE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>jpomService<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">CommandUtil</span><span class="token punctuation">.</span><span class="token function">asyncExeLocalCommand</span><span class="token punctuation">(</span>command<span class="token punctuation">,</span> parentFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 使用了服务</span>
                    <span class="token class-name">CommandUtil</span><span class="token punctuation">.</span><span class="token function">asyncExeLocalCommand</span><span class="token punctuation">(</span><span class="token string">&quot;systemctl restart &quot;</span> <span class="token operator">+</span> jpomService<span class="token punctuation">,</span> parentFile<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;重启自身异常&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h4 id="异步执行-⛓"><a href="#异步执行-⛓" class="header-anchor">#</a> 异步执行 ⛓</h4> <p>通常我们在调用重启方法是通过接口（Controller）来实现，这样如果不异步线程执行那么请求此接口将无法等待到任何响应就开始执行重启流程，这样给用户的体验就不知道是否开始执行重启，会误解为后台一直卡住。</p> <p>建议：前端在收到此接口相应后可以开启一个全屏遮罩层，并轮询一个特定接口来判断新的服务是否启动成功。</p> <h4 id="功能扩展-🎬"><a href="#功能扩展-🎬" class="header-anchor">#</a> 功能扩展 🎬</h4> <p>有来上述方案和流程后就是如何实现业务功能，您在开发业务时候需要考虑如何更新新程序包：</p> <ul><li>在线下载</li> <li>手动上传</li></ul> <p><strong>在线下载</strong>：要您提供一个版本检测接口和程序包下载服务，
程序定时（每天凌晨或者中午）请求一次版本信息接口与当前运行中的版本比较，
如果有新版本您可以做弹窗提醒、特定页面查看（Jpom 使用此方法）、自动下载并升级（不建议）</p> <p><strong>手动上传</strong>：如果您没有办法提供一个检测接口、下载服务、网络限制您只能使用手动上传的方式来更新程序包，java 程序实现上传这个功能非常通用。</p> <blockquote><p>在线下载或者手动上传需要自行实现将对应的程序包存放于程序的运行 lib 路径</p></blockquote> <p><strong>不兼容升级</strong>：软件的不同版本迭代会因为功能变动、依赖升级等造成无法平滑升级的情况是时有发生的，此时您在开发业务时候就需要考虑到更新程序包时候判断当前运行的版本和要更新的新版本是否支持平滑升级，如果不支持平滑升级则提醒用户需要手动处理升级并告知操作流程。</p> <p>在 Jpom 实践中出现过 2 次不兼容升级：</p> <ol><li><a href="https://jpom.top/pages/upgrade/2.8.x-to-2.9.x/" target="_blank" rel="noopener noreferrer">v2.8.x 升级到 v.2.9.x<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://jpom.top/pages/upgrade/2.9.x-to-2.10.x/" target="_blank" rel="noopener noreferrer">v2.9.x 升级到 v.2.10.x<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol> <blockquote><p>如果您对如何完整的实现升级业务逻辑还有疑问，欢迎加入 <a href="https://jpom.top/pages/praise/join/" target="_blank" rel="noopener noreferrer">Jpom 社群<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>来交流。</p></blockquote> <h2 id="写在最后-🙏"><a href="#写在最后-🙏" class="header-anchor">#</a> 写在最后 🙏</h2> <p>感谢您耐心阅读本文，希望本文能给您带来一定的价值。</p> <p>如果觉得本文对您有帮助，请点个“赞”/“在看”支持一下，谢谢。</p> <p>如您对本文有<code>任何疑问</code>、<code>不足之处</code>欢迎您加入 <a href="https://jpom.top/pages/praise/join/" target="_blank" rel="noopener noreferrer">Jpom 社群<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>来交流，对本方案有更好的调优建议我们也非常欢迎您指出。</p> <p>本文首发于 <a href="https://jpom.top/" target="_blank" rel="noopener noreferrer">Jpom 官方<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 欢迎访问，如需转载请先<a href="https://gitee.com/bwcx-jzy" target="_blank" rel="noopener noreferrer">联系作者<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h2 id="jpom-链接-✈"><a href="#jpom-链接-✈" class="header-anchor">#</a> Jpom 链接 ✈</h2> <p>官网：<a href="https://jpom.top/" target="_blank" rel="noopener noreferrer">https://jpom.top/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Gitee: <a href="https://gitee.com/dromara/Jpom" target="_blank" rel="noopener noreferrer">https://gitee.com/dromara/Jpom<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Github: <a href="https://github.com/dromara/Jpom" target="_blank" rel="noopener noreferrer">https://github.com/dromara/Jpom<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>加入社群：<a href="https://jpom.top/pages/praise/join/" target="_blank" rel="noopener noreferrer">https://jpom.top/pages/praise/join/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div></div> <div class="page-slot page-slot-bottom">

  </div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/bwcx-jzy/jpom-docs/edit/main/docs/推广文章/Java项目自动升级的方式之一.md" target="_blank" rel="noopener noreferrer">帮助我们改善此文档</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/tags/?tag=%E6%8E%A8%E5%B9%BF%E6%96%87%E7%AB%A0" title="标签">#推广文章</a></div> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2024/11/30, 02:59:16</span></div></div> <div class="page-nav-wapper"><!----> <!----></div></div> <div class="article-list"><div class="article-title"><a href="/archives" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/db/e59f85/"><div>
            H2 迁移到 DAMENG
            <!----></div></a> <span class="date">05-12</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/da38d0/"><div>
            2025年
            <!----></div></a> <span class="date">01-14</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/40765e/"><div>
            宝塔面板部署
            <!----></div></a> <span class="date">11-05</span></dt></dl> <dl><dd></dd> <dt><a href="/archives" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="https://gitee.com/dromara/Jpom" title="Gitee" target="_blank" class="iconfont icon-gitee"></a><a href="https://github.com/dromara/Jpom" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2025
    <span> | Jpom开源项目<p><a href="/pages/user/">我们用户</a> | <a href="/pages/praise/friends/">贡献者们</a> | <a href="/pages/souvenir/">专属纪念品</a></p><span id='busuanzi_container_site_pv'>本站访问量：<span id='busuanzi_value_site_pv'>-</span></span> |  <a href="http://beian.miit.gov.cn/" target="_blank">京ICP备17044819号</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><span class="close-but">×</span> <div>
<!--  <div class="custom-block danger"><p class="custom-block-title">系统公告</p> <p>近期我们下载中心受到持续的恶意刷流量，给我们的长期运营带来了很大的挑战。我们已经将下载中心迁移至 cloudflare，部分网络环境下使用可能不便还请谅解。</p>-->
<!--  <p><a href="/pages/malice-fraudulent/" target="_blank">点击查看详情</a></p>-->
<!--  </div>-->
  </div></div></div></div><div class="global-ui"><div></div><!----></div></div>
    <script src="/assets/js/app.28fbb888.js" defer></script><script src="/assets/js/9.dee3cbec.js" defer></script><script src="/assets/js/6.c6620675.js" defer></script><script src="/assets/js/1.5ec0786d.js" defer></script>
  </body>
</html>
